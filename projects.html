---
layout: default
title: Projects
---

<div class="container">
	<div class="col-lg-12 ">
		<div class="col-lg-12 starter-template">
			<h1>Our Projects</h1>
			<p class="lead">Code for DC is a collaborative environment in which people with many different skillsets tackle issues they see facing the community. Our projects are always looking for help.  Browse below and you're bound to find a project that needs you!</p>
		</div>
		<table class="table table-striped" id="project-list">
			<thead>
				<tr>
					<th class="col-sm-3"><h2>Project</h2></th>
					<th class="col-sm-4"><h2>About</h2></th>
					<th class="col-sm-3"><h2>Vitals</h2></th>
					<th class="col-sm-2"><h2>Categories</h2></th>
				</tr>
			</thead>
			<tbody>

			</tbody>
			<!-- populated by js -->
		</table>
	</div>
</div><!-- /.container -->

{% include _global_js.html %}
<script src="assets/js/moment.min.js"></script>
<script src="assets/js/d3.min.js"></script>
<script type="text/javascript">

// Load the civic.json file and get working
// This code is based on the projects page at https://github.com/open-city/open-gov-hack-night
$.getJSON("/civic.json", function(data){
	var projects = data["projects"];
	// Sort projects by most recently updated
	projects.sort(function(a,b) {return new Date(b.updated_at) - new Date(a.updated_at)})
	// Begin iterating over the JSON file
	$.each(projects, function(i,info){
		// Get info for the project, starting with Github info that always exists
		var name = info["name"];
		var description = info["description"];
		var created = moment(info["created_at"]).fromNow();
		var updated = moment(info["updated_at"]).fromNow();
		var issues = info["open_issues"];
		var repo_link = info["html_url"];
		var contributors = "<strong>Contributors</strong><p style='line-height:325%'>";
		$.each(info["contributors"], function(k,v){
			contributors += "<a href='"+v["link"]+"'><img class='img-rounded' height='40' width='40' src="+v["avatar_url"]+"></a>";
		});
		if (info["homepage"]){
			var homepage = "<a href='"+info["homepage"]+"'>website</a>";
		} else {
			var homepage = "";
		}
		var needs = "";
		var contact = "";
		var community = "";
		var government = "";
		var categories = "";
		var status = "";
		var moreinfo = "";
		// Add info from civic.json file, if it exists
		if (info["civic_json"]){
			var email = info["civic_json"]["contact"][0]["email"];
			if (email){
				contact += "<a class='btn btn-default btn-sm' role='button' href='mailto:"+email+"'><i class='fa fa-envelope fa-lg'></i></a> "
			}
			var twitter = info["civic_json"]["contact"][0]["twitter"];
			if (twitter){
				twitter = twitter.slice(1,twitter.length);
				contact += "<a class='btn btn-default btn-sm' role='button' href='https://twitter.com/"+twitter+"'><i class='fa fa-twitter fa-lg'></i></a> "
			}
			if (info["civic_json"]["needs"]){
				var needs = "<strong>Needs</strong><p style='line-height:250%'>";
				$.each(info["civic_json"]["needs"], function(k,v){
					needs += "<button class='btn btn-sm btn-success'>"+v["need"]+"</button> ";
				});
			}
			if (info["civic_json"]["categories"]){
				$.each(info["civic_json"]["categories"], function(k,v){
					categories += "<p><button class='btn btn-sm btn-warning'>"+v["category"]+"</button></p>";
				})
			}
			if (info["civic_json"]["status"]){
				var status = "<strong>Status: </strong>"+info["civic_json"]["status"];
			}
			if (info["civic_json"]["governmentPartner"]){
				var government = "Government Partner: "+info["civic_json"]["governmentPartner"];
			}
			if (info["civic_json"]["communityPartner"]){
				var community = "Community Partner: "+info["civic_json"]["communityPartner"];
			}
		}
		// Insert the information into the site's HTML
		$("#project-list>tbody").append(
			"<tr id='project"+i+"'>\
				<td class='column-1'>\
					<h3><a href='"+repo_link+"'>"+name+"</a></h3>\
					<p>"+contact+"</p>\
					<p>"+homepage+"</p>\
					<p>"+moreinfo+"</p>\
					<p>"+community+"</p>\
					<p>"+government+"</p>\
					<div class='activity'></div>\
				</td>\
				<td class='column-2'>\
					<p>"+description+"</p>\
					<p>"+needs+"</p>\
					<p>"+contributors+"</p>\
				</td>\
				<td class='column-3'>\
					<p><strong>Born</strong> "+created+"</p>\
					<p>"+status+"</p>\
					<p><strong>Issues:</strong> <a class='btn btn-default' role='button' href='"+repo_link+"/issues'>"+issues+"</a></p>\
				</td>\
				<td class='column-4'>\
					<p>"+categories+"</p>\
				</td>\
			</tr>"
		);
		// Create a graph of the Github repo's commit history using D3.js, based on https://gist.github.com/ashleybot/1842440
		// This is done after everything else because it requires a HTML element on which to operate

		// Scale the repo activity to make graphs consistent
		var scaled = [];
		$.each(info["activity"],function(i,n){
			scaled.push(n * 100/Math.max.apply(null, info["activity"]));
		})

		var w = $(".column-1").width() / 52,
			h = 90;

		var chart = d3.select("#project"+i+" .activity").append("svg")
			.attr("class", "chart")
			.attr("width", w * 52)
			.attr("height", h);

		var x = d3.scale.linear()
			.domain([0, 1])
			.range([0, w]);

		var y = d3.scale.linear()
			.domain([0, 50])
			.rangeRound([0, h]); //rangeRound is used for antialiasing

		chart.selectAll("rect")
			.data(scaled)
		.enter().append("rect")
			.attr("x", function(d, i) { return x(i) - .5; })
			.attr("y", function(d) { return h - y(d) - .5; })
			.attr("width", w)
			.attr("height", function(d) { return y(d); } )
			.attr("fill", "#9E9E9E");
	});
});
</script>
